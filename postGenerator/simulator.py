import random
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# ==========================================
# 1. 設問データ (最新の劇薬配点)
# ==========================================
questions = [
    {"q": "自撮り", "options": [("清楚", (5, 0, -10, 50)), ("グラビア", (25, 15, 15, 0)), ("露出", (45, 45, 60, -50)), ("地雷", (15, -15, 30, 0))]},
    {"q": "SNS営業", "options": [("ポスト", (-10, -20, 0, 40)), ("DM告知", (15, 5, 5, 20)), ("DM寂しい", (35, 25, 30, -10)), ("DM催促", (50, 40, 20, -20))]},
    {"q": "SNS運用", "options": [("なし", (-20, -30, 0, 30)), ("いいね", (-5, 10, 10, 30)), ("太客厚め", (40, 30, 40, -10)), ("適当", (15, 15, 15, 15))]},
    {"q": "ドリンク", "options": [("丁寧", (5, -10, -5, 50)), ("タメ口", (30, 20, 20, -10)), ("無言", (40, 40, 30, 10)), ("喉乾いた", (25, 15, 15, 5))]},
    {"q": "チェキ距離", "options": [("ソーシャル", (-20, -10, -10, 50)), ("こぶし", (10, 5, 5, 30)), ("接触少", (35, 25, 25, 0)), ("密着", (60, 50, 60, -50))]},
    {"q": "ガチ恋対応", "options": [("絡める", (60, 60, 50, -60)), ("ボトル", (10, 40, 50, 0)), ("許容", (40, 20, 20, 0)), ("制する", (-30, -40, -20, 60))]},
    {"q": "深夜DM", "options": [("おやすみ", (20, 10, 0, 10)), ("未読", (-10, -20, 0, 40)), ("寝てた", (10, 0, 5, 30)), ("既読放置", (5, -10, 0, 30))]},
    {"q": "説教リアル", "options": [("聞く", (40, 50, -10, 30)), ("流す", (5, 10, 5, 20)), ("話題変える", (-10, 20, 15, 15)), ("反論", (-20, 30, 30, 5))]},
    {"q": "説教DM", "options": [("フリ返信", (50, 50, -10, 30)), ("晒す", (-20, 30, 40, -10)), ("スタンプ", (-15, 20, 20, 10)), ("ブロック", (-40, -50, 20, 10))]},
    {"q": "下ネタ", "options": [("即答", (50, 60, 50, -40)), ("とぼける", (0, -10, -10, 20)), ("交換条件", (30, 25, 20, 10)), ("断絶", (-20, -50, -10, 60))]},
    {"q": "卑猥画像", "options": [("金次第", (20, 60, 30, -30)), ("煽る", (-30, 50, 20, -10)), ("スルー", (0, -10, 0, 30)), ("報告", (0, 10, -30, 50))]},
    {"q": "素伝客", "options": [("聖母", (45, 40, 20, 10)), ("圧", (15, 20, 15, 10)), ("放置", (-20, -15, 10, 30)), ("おねだり", (-10, 10, 5, 20))]},
    {"q": "推し変", "options": [("拗ねる", (40, 20, 10, -10)), ("同調", (5, 10, 5, 30)), ("温度0", (10, -10, 15, 20)), ("切り捨て", (20, 0, 10, 0))]},
    {"q": "臭い客", "options": [("笑顔耐え", (20, 40, 5, 30)), ("距離", (5, -10, 0, 20)), ("ファブ", (10, 30, 30, -20)), ("指摘", (-10, 40, 20, -30))]},
    {"q": "繋がり要求", "options": [("いつか", (30, 30, 20, 10)), ("辞めたら", (45, 20, 50, -20)), ("無理", (0, 10, 5, 20)), ("出禁宣告", (-30, 30, -20, 60))]},
    {"q": "店外要求", "options": [("嘘つく", (55, 40, 15, -40)), ("100万", (15, 40, 30, 10)), ("相手次第", (5, 30, 60, -60)), ("規約", (-20, -20, -20, 60))]},
    {"q": "シャンパン", "options": [("喜ぶ", (30, 10, 30, 30)), ("お礼詐欺", (50, 45, 20, -10)), ("丁寧", (10, -10, 5, 30)), ("次要求", (20, 30, 20, 10))]},
    {"q": "喧嘩対応", "options": [("警察呼ぶ", (0, -10, 20, 50)), ("注意", (-10, 30, -10, 40)), ("放置", (0, -30, 10, -30)), ("煽る", (0, 30, 60, -50))]},
    {"q": "卒業時", "options": [("嘘会おう", (60, 50, 40, -50)), ("断絶感謝", (-20, -10, -20, 50)), ("相手による", (10, -10, 40, -40)), ("転生煽り", (20, 20, 10, 20))]},
    {"q": "客とは", "options": [("人生の糧", (30, 30, 20, 30)), ("ATM", (-30, 30, 50, 0)), ("遊び相手", (15, 10, 10, 40)), ("攻略対象", (15, 25, 10, 20))]}
]

# ==========================================
# 2. シミュレーション実行
# ==========================================
def run_simulation(n=10000, denom=4):
    results = []
    for _ in range(n):
        s_tot, m_tot, r_tot, c_tot = 0, 0, 0, 0
        for q in questions:
            # 各設問からランダムに1つの選択肢の配点を取得
            pts = random.choice(q["options"])[1]
            s_tot += pts[0]
            m_tot += pts[1]
            r_tot += pts[2]
            c_tot += pts[3]
        
        # 最終スコア計算
        results.append({
            "営業火力": max(min(s_tot // 5, 100), 0),
            "対人胆力": max(min(m_tot // 6, 100), 0),
            "爆弾指数": max(min(r_tot // 6, 100), 0),
            "規律遵守": max(min(c_tot // 4, 100), 0)
        })
    return pd.DataFrame(results)

# 実行（分母4でテスト）
df = run_simulation(10000, denom=4)

# ==========================================
# 3. ビジュアライズ
# ==========================================
plt.rcParams['font.family'] = 'MS Gothic' # 日本語化が必要な場合は適宜修正
plt.figure(figsize=(12, 10))

for i, col in enumerate(df.columns):
    plt.subplot(2, 2, i+1)
    # グラフの描画
    sns.histplot(df[col], bins=25, kde=True, color="salmon" if "爆弾" in col else "skyblue")
    
    # 統計情報の表示
    stats = df[col].describe()
    plt.axvline(stats['mean'], color='red', linestyle='--', label=f"Mean: {stats['mean']:.1f}")
    plt.title(f"{col} の分布 (Std: {stats['std']:.1f})")
    plt.legend()
    plt.xlim(0, 100)

plt.tight_layout()
plt.show()

# 相関関係の表示（営業火力が上がると規律遵守が下がるか？）
print("\n--- パラメーター間の相関係数 ---")
print(df.corr())