<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Mosaic your words</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
  <style>
    :root { color-scheme: dark; }
    body { margin: 0; background: #111; color: #ddd; font-family: 'Noto Sans', 'Segoe UI Symbol', 'Noto Sans Symbols', sans-serif; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 16px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 16px; }
    .row.grid { grid-template-columns: 1fr 1fr; }
    textarea, input, select, button {
      background: #1a1a1a; color: #eee; border: 1px solid #444; padding: 8px; border-radius: 6px;
    }
    textarea { min-height: 110px; resize: vertical; }
    .preview { white-space: pre-wrap; border: 1px dashed #444; padding: 10px; border-radius: 6px; word-break: break-word; }
    .hint { font-size: 12px; color: #aaa; }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; }
    .toolbar > * { flex: 1 1 160px; }
    .status { font-size: 12px; color: #9aa; margin-top: 8px; 
    .small { font-size: 12px; }
    .inline { display: inline-block; }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Abuse Mitigation Generator</h1>
  <div class="hint">æš´è¨€ã‚„å¼·ã„è¨€è‘‰ã«åŠãƒ¢ã‚¶ã‚¤ã‚¯ã‚’æ›ã‘ãŸã‚Šã€æ¿éŸ³åŠæ¿éŸ³ã‚’ä»˜ã‘ã¦æŸ”ã‚‰ã‹ã«ã—ã¾ã™ã€‚</div>
  <div class="row">
      å…¥åŠ›æ–‡å­—åˆ—
      <textarea id="input" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
  </div>

  <div class="toolbar">
    <label class="inline">ãƒ—ãƒªã‚»ãƒƒãƒˆ
      <select id="preset">
        <option value="none">ãªã—ï¼ˆç´ ã®æ–‡å­—ï¼‰</option>
        <option value="mold">åŠãƒ¢ã‚¶ã‚¤ã‚¯</option>
        <option value="semi_letter">æ¿ç‚¹ã€åŠæ¿ç‚¹</option>
        <option value="correction" selected>ãƒã‚¤ã‚º(ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆç”¨)</option>
        <option value="all">æ··åˆ</option>
				<option value="cuneiform">æ¥”å½¢æ–‡å­—(æ··å…¥)</option>
   			<option value="zalgo">æ·±æ·µ(Zalgo)</option>
      </select>
    </label>
    <label class="inline">æ¿ƒã•
      <select id="density">
        <option value="1" selected>1</option>
        <option value="2">2</option>
        <option value="4">4</option>
      </select>
    </label>
    <label class="inline">æ­£è¦åŒ–
      <select id="norm">
        <option value="NFC">NFC</option>
        <option value="NFD" selected>NFD</option>
        <option value="NFKC">NFKC</option>
        <option value="NFKD">NFKD</option>
      </select>
    </label>
  </div>

  <div class="row">
    <label>
      å‡ºåŠ›
      <textarea id="output" readonly style="display: none;"></textarea>
    </label>
    <div id="preview" class="preview"></div>
  <div class="row grid">
    <button id="copy">å‡ºåŠ›ã‚’ã‚³ãƒ”ãƒ¼</button>
  </div>
  <div class="row grid">
    <button id="apply">ã‚„ã‚Šç›´ã—</button>
  </div>
    <div id="status" class="status">Ready</div>

  </div>
</div>

<script>
  const ZERO_WIDTH = new Set(["\u200B","\u200C","\u200D","\u2060","\uFEFF"]);

  // æ—¥æœ¬èªå¯¾å¿œçµåˆæ–‡å­—ã‚»ãƒƒãƒˆ
	const MOLD=["\u0488","\u0489"];
	const SEMI_LETTER=["\u3099","\u309A"]
	const CORRECTIONS=["\u0304","\u0305","\u0331","\u0307"]
  const SAFE_JAPANESE = ["\u0488","\u0489","\u3099","\u309A"]; // Òˆ Ò‰ ã‚™ ã‚š
	const CUNEIFORM = ["\u{12462}", "\u{1209D}", "\u{12152}", "\u{12031}"]; // ğ’„†, ğ’‚, ğ’…’, ğ’€±
	const ZALGO_UP = ["\u030d", "\u030e", "\u0304", "\u0305", "\u033f", "\u0311", "\u0306", "\u0310", "\u0352", "\u0357", "\u0351"];
	const ZALGO_DOWN = ["\u0316", "\u0317", "\u0318", "\u0319", "\u031c", "\u031d", "\u031e", "\u031f", "\u0320", "\u0324", "\u0330"];

  const inputEl = document.getElementById('input');
  const outputEl = document.getElementById('output');
  const previewEl = document.getElementById('preview');
  const statusEl = document.getElementById('status');
  const presetEl = document.getElementById('preset');
  const normEl = document.getElementById('norm');
  const densityEl = document.getElementById('density');
  const applyBtn = document.getElementById('apply');
  const copyBtn = document.getElementById('copy');

  function normalize(str) {
    try { return str.normalize(normEl.value); } catch { return str; }
  }

  function sanitizeBase(ch) {
    const cp = ch.codePointAt(0);
    if ((cp <= 0x1F && ch !== "\n" && ch !== "\t") || (cp >= 0x7F && cp <= 0x9F)) return "";
    if (ZERO_WIDTH.has(ch)) return "";
    return ch;
  }

  function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }


	function decorateChar(ch, mode, dens) {
	  const base = sanitizeBase(ch);
	  if (!base) return "";

	  let marks = [];

	  switch (mode) {
	    case "none":
	      return base;

	    case "mold":
	      for (let i = 0; i < dens; i++) marks.push(pick(MOLD));
	      break;

	    case "semi_letter":
	      // æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ã¯æœ€å¤§1å€‹
	      marks.push(pick(SEMI_LETTER));
	      break;
			case "correction":
	      for (let i = 0; i < dens; i++) marks.push(pick(CORRECTIONS));
	      break;
	    case "all":
	      let usedDakuten = false;
	      for (let i = 0; i < dens + 1; i++) {
	        const m = pick(SAFE_JAPANESE);
	        if ((m === "\u3099" || m === "\u309A") && usedDakuten) continue;
	        if (m === "\u3099" || m === "\u309A") usedDakuten = true;
	        marks.push(m);
	      }
	      break;

			case "cuneiform":
			  // æ–‡å­—ã®ç›´å¾Œã«ãƒ©ãƒ³ãƒ€ãƒ ã§æ¥”å½¢æ–‡å­—ã‚’1ã¤æŒ¿å…¥ã™ã‚‹
			  marks.push(pick(CUNEIFORM));
			  break;

			case "zalgo":
			  // ä¸Šä¸‹ã«çªãæŠœã‘ã‚‹çµåˆæ–‡å­—ã‚’å¯†ã«é…ç½®ã™ã‚‹
			  for (let i = 0; i < dens * 2; i++) {
			    marks.push(pick(ZALGO_UP));
			    marks.push(pick(ZALGO_DOWN));
			  }
			  break;

	    default:
	      return base;
	  }

	  return base + marks.join("");
	}


  function decorateText(text) {
    const normalized = normalize(text);
    let out = "";
    for (const ch of normalized) {
      if (ch === "\n") { out += "\n"; continue; }
      out += decorateChar(ch, presetEl.value, Number(densityEl.value));
    }
    return out;
  }

  function render() {
    const src = inputEl.value || "";
    const decorated = decorateText(src);
    outputEl.value = decorated;
    previewEl.textContent = decorated;
    statusEl.textContent = `norm=${normEl.value} preset=${presetEl.value} density=${densityEl.value}`;
  }

  applyBtn.onclick = render;
  inputEl.addEventListener('input', render);
  presetEl.addEventListener('change', render);
  normEl.addEventListener('change', render);
  densityEl.addEventListener('change', render);

  copyBtn.onclick = async () => {
    try {
      await navigator.clipboard.writeText(outputEl.value);
      statusEl.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†";
    } catch {
      statusEl.textContent = "ã‚³ãƒ”ãƒ¼å¤±æ•—ï¼ˆè¨±å¯ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ï¼‰";
    }
  };

  render();
</script>
</body>
</html>